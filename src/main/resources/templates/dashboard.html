<!DOCTYPE html>
<html lang="fa" dir="rtl" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>داشبورد - ساندویچ فروشی</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
<nav class="bg-blue-500 text-white p-4 rounded mb-4 flex justify-between">
    <h1>داشبورد <span sec:authentication="name"></span></h1>
    <a th:href="@{/logout}" class="bg-red-500 px-4 py-1 rounded">خروج</a>
</nav>

<div sec:authorize="hasRole('ADMIN')">
    <h2 class="text-xl mb-4">پنل ادمین</h2>
    <div class="grid grid-cols-2 gap-4">
        <div>
            <h3 class="font-bold">لیست مشتریان</h3>
            <table class="w-full border-collapse border border-gray-300">
                <thead>
                <tr>
                    <th class="border px-4 py-2">ID</th>
                    <th class="border px-4 py-2">نام</th>
                    <th class="border px-4 py-2">عملیات</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="user : ${customers}">
                    <td th:text="${user.id}" class="border px-4 py-2"></td>
                    <td th:text="${user.name}" class="border px-4 py-2"></td>
                    <td class="border px-4 py-2">
                        <button th:onclick="'deleteUser(' + ${user.id} + ')'"
                                class="bg-red-500 text-white px-2 py-1 rounded">حذف
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div>
            <h3 class="font-bold">لیست سفارش‌ها</h3>
            <table class="w-full border-collapse border border-gray-300">
                <thead>
                <tr>
                    <th class="border px-4 py-2">ID</th>
                    <th class="border px-4 py-2">وضعیت</th>
                    <th class="border px-4 py-2">عملیات</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="order : ${orders}">
                    <td th:text="${order.id}" class="border px-4 py-2"></td>
                    <td th:text="${order.status}" class="border px-4 py-2"></td>
                    <td class="border px-4 py-2">
                        <select th:attr="onchange=|'updateStatus(' + ${order.id} + ', this.value)'|">
                            <option th:each="status : ${statuses}" th:value="${status}" th:text="${status}"></option>
                        </select>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div sec:authorize="hasRole('CUSTOMER')">
    <h2 class="text-xl mb-4">پنل مشتری</h2>
    <div class="mb-4">
        <h3 class="font-bold">سفارش‌های من</h3>
        <table class="w-full border-collapse border border-gray-300">
            <thead>
            <tr>
                <th class="border px-4 py-2">ID</th>
                <th class="border px-4 py-2">قیمت کل</th>
                <th class="border px-4 py-2">وضعیت</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="order : ${myOrders}">
                <td th:text="${order.id}" class="border px-4 py-2"></td>
                <td th:text="${order.totalPrice}" class="border px-4 py-2"></td>
                <td th:text="${order.status}" class="border px-4 py-2"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div>
        <h3 class="font-bold">ساخت سفارش جدید</h3>
        <form th:action="@{/api/orders}" method="post">
            <select multiple class="w-full p-2 border rounded mb-2" name="orderItems[0].ingredients" size="10">
                <option th:each="ing : ${ingredients}" th:value="${ing.id}"
                        th:text="${ing.name + ' (' + ${ing.price} + ' تومان)'}"></option>
            </select>
            <input type="number" name="orderItems[0].quantity" value="1" class="p-2 border rounded mb-2" min="1">
            <button type="submit" class="bg-green-500 text-white p-2 rounded">ایجاد سفارش</button>
        </form>
    </div>
</div>

<script>
    function deleteUser(id) {
        if (confirm('حذف کاربر؟')) {
            fetch(`/api/users/${id}`, {method: 'DELETE'}).then(() => location.reload());
        }
    }

    function updateStatus(id, status) {
        fetch(`/api/orders/${id}/status`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(status)
        }).then(() => location.reload());
    }
</script>
</body>
</html>